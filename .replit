modules = ["nodejs-20"]
run = "node index.js"

[nix]
channel = "stable-25_05"

[deployment]
run = ["sh", "-c", "node index.js"]

[workflows]
runButton = "Backend Dev Server"

[[workflows.workflow]]
name = "Backend Dev Server"
author = 45942358
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd backend && npm install && node scripts/start-dev.js"

[[workflows.workflow]]
name = "Run Tests"
author = 45942358
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd backend && node test/setup-test-env.js && node test/getToken.js test@example.com password123 && TEST_TOKEN=$(node test/getToken.js test@example.com password123 | grep \"Token:\" | cut -d' ' -f2) node test/api-test.js"

[[workflows.workflow]]
name = "Install Dependencies"
author = 45942358
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd backend && npm install"

[[workflows.workflow]]
name = "Run All Tests"
author = 45942358
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd backend && npm run test && echo \"Get token first:\" && node test/getToken.js test@example.com password123"

[[workflows.workflow]]
name = "Setup & Test Complete"
author = 45942358
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd backend && node test/setup-test-env.js && echo \"Now get your token:\" && echo \"node test/getToken.js your@email.com yourpassword\""
